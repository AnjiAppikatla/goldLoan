<main class="p-4 md:p-6">
  <!-- Header Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-2">
    <div>
      <h2 class="text-xl font-poppins font-bold">Welcome, Admin User</h2>
    </div>
    <!-- Filter Section -->
    <div class="bg-white rounded-lg">
      <div class="flex flex-col sm:flex-row gap-4">
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Select Time Period</mat-label>
          <mat-select [(ngModel)]="selectedPeriod" (selectionChange)="onPeriodChange()">
            <mat-option value="today">Today</mat-option>
            <mat-option value="yesterday">Yesterday</mat-option>
            <mat-option value="week">Last Week</mat-option>
            <mat-option value="month">Last Month</mat-option>
            <mat-option value="custom">Custom Range</mat-option>
          </mat-select>
        </mat-form-field>

        <div *ngIf="selectedPeriod === 'custom'" class="flex flex-col sm:flex-row gap-4 w-full sm:w-auto">
          <mat-form-field appearance="outline" class="w-full sm:w-40">
            <mat-label>Start Date</mat-label>
            <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate" (dateChange)="onDateChange()">
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full sm:w-40">
            <mat-label>End Date</mat-label>
            <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate" (dateChange)="onDateChange()">
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
    </div>
  </div>



  <!-- Charts Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:mb-2 mb-6">
    <!-- Agent Distribution Chart -->
    <div class="bg-white p-4 md:p-6 rounded-lg cm-shadow h-[400px]">
      <h3 class="text-lg font-semibold mb-4">Loans By Agent's</h3>
      <div class="h-[calc(100%-4rem)]">
        <canvas id="goldDistributionChart"></canvas>
      </div>
    </div>

    <!-- Time Distribution Chart -->
    <div class="bg-white p-4 md:p-6 rounded-lg cm-shadow h-[400px]">
      <h3 class="text-lg font-semibold mb-4">Loans By Time</h3>
      <div class="h-[calc(100%-2rem)]">
        <canvas id="timeDistributionChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Recent Loans Section -->
  <div class="bg-white rounded-lg">
    <h3 class="text-lg font-semibold mb-4">Recent Loans</h3>
    <mat-accordion class="grid grid-cols-1 gap-4 app-accordion-bg">
      <mat-expansion-panel *ngFor="let loan of recentLoans">
        <mat-expansion-panel-header>
          <mat-panel-title class="flex items-center gap-4 w-full">
            <div class="flex items-center gap-2 flex-1">
              <span class="font-medium text-white">{{loan.Name}}</span>
            </div>
            <div class="loan-progress-mini flex items-center gap-2" *ngIf="loan?.progress">
              <div class="progress-bar w-16 sm:w-24 h-[20px] bg-gray-200 rounded-sm overflow-hidden relative">
                <div class="h-full transition-all duration-300"
                  [style.background]="'linear-gradient(to right, #22c55e ' + (100 - loan.progress) + '%, #ef4444 ' + loan.progress + '%)'"
                  [style.width.%]="100">
                </div>
              </div>
              <span class="text-sm text-white">
                {{loan.progress | number:'1.0-0'}}%
              </span>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pt-4">
          <!-- Personal Details -->
          <div class="bg-gray-200 p-4 rounded">
            <h3 class="mb-2 text-amber-500 font-bold">Personal Details</h3>
            <p><strong>Lender :</strong> {{loan.Lender}}</p>
            <p><strong>LeadId :</strong> {{loan.LeadId}}</p>
            <p><strong>Phone :</strong> {{loan.MobileNo}}</p>
            <p><strong>City :</strong> {{loan.City}}</p>
            <p><strong>Agent Name :</strong> {{loan.AgentName}}</p>
          </div>

          <!-- Loan Details -->
          <div class="bg-gray-200 p-4 rounded">
            <h3 class="mb-2 text-amber-500 font-bold">Loan Details</h3>
            <p><strong>Amount :</strong> {{loan.Amount}}</p>
            <p><strong>Issue Date :</strong> {{loan.IssuedDate | date}}</p>
            <p><strong>Maturity Date :</strong> {{loan.MaturityDate | date}}</p>
            <p><strong>Aadhar:</strong> {{loan.AadharNumber}}</p>
            <p><strong>PAN:</strong> {{loan.PanNumber}}</p>
          </div>

          <!-- Revenue Details -->
          <div class="bg-gray-200 p-4 rounded" *ngIf="currentUser?.role === 'admin'">
            <h3 class="mb-2 text-amber-500 font-bold relative">Revenue
              <span class="absolute right-0 top-0">
                <button mat-icon-button color="primary" class="focus-visible:outline-2 focus-visible:outline-offset-2">
                  <mat-icon>edit</mat-icon>
                </button>
              </span>
            </h3>
            <p><strong>Total Revenue :</strong> {{loan.CommissionAmount}}</p>
            <p><strong>Received :</strong> {{loan.totalReceivedCommission}}</p>
            <p><strong>Receivable :</strong> {{loan.receivableCommission}}</p>
          </div>

          <!-- Payment Details -->
          <div class="bg-gray-200 p-4 rounded">
            <h3 class="mb-2 text-amber-500 font-bold">Payment Details</h3>
            <p><strong>Payment Date :</strong> {{loan.PaymentDate | date}}</p>
            <p><strong>Payment Type :</strong> {{loan.MerchantId}}</p>
            <ng-container [ngSwitch]="loan.paymentType">
              <ng-container *ngSwitchCase="'Cash'">
                <p><strong>Cash Amount :</strong> {{loan.CashAmount}}</p>
              </ng-container>
              <ng-container *ngSwitchCase="'Online'">
                <p><strong>Online Amount :</strong> {{loan.OnlineAmount}}</p>
              </ng-container>
              <ng-container *ngSwitchCase="'Both'">
                <p><strong>Cash Amount :</strong> {{loan.CashAmount}}</p>
                <p><strong>Online Amount :</strong> {{loan.OnlineAmount}}</p>
              </ng-container>
            </ng-container>
          </div>

          <!-- Refund Details -->
          <div class="bg-gray-200 p-4 rounded">
            <h3 class="mb-2 text-amber-500 font-bold">Refund Details</h3>
            <p><strong>Refund Date :</strong> {{loan.PaymentDate | date}}</p>
            <p><strong>Account Name :</strong> {{loan.AccountName}}</p>
            <p><strong>Account Number :</strong> {{loan.AccountNumber}}</p>
            <p><strong>IFSC Code :</strong> {{loan.IfscCode}}</p>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</main>